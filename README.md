# CNRMppe
Codebase for CNRM Perturbed Physic Ensemble processing. (last modify : Saloua Peatier, 08/07/2020)
## PPE 
### scripts
#### Analyse
 - biases_CERES_PPE.ipynb : biases estimate in TOA radiative fluxes between CNRM_amip_PPE outputs and CERES observation dataset.  
 - CFMIP_Lambda.ipynb : TOA global net radiative feedbacks from different CMIP6 outputs, different models and different simulations (amip-4xCO2, amip-p4K, amip-future4K).
 - crop_PPE.ipynb : crop the first CNRM_PPE to remove high ALFX and low RKDN base on limits of the second ensemble.
 - EOFs_analysis_feedbacks.ipynb : EOF analysis of TOA global net radiative feedbacks in CNRM_PPE (amip and amip-future4K)
 - EOFs_analysis_mean_state.ipynb : EOF analysis of TOA radiative fluxes in CNRM_amip_PPE
 - feedbacks_global_mean.ipynb : TOA global net radiative feedbacks in CNRM_PPE (amip and amip-future4K)  
 - feedbacks_spatial.ipynb : TOA 3D net radiative feedbacks in CNRM_PPE (amip and amip-future4K)
##### klein2013-cloud-error-metrics
 - Git repository of Klein et al. code for the estimate of error metrics with ISCCP simulator : E_TCA, E_ctp-tau, E_SW, E_LW 
#### Emulation
 - ENSEMBLE1_MultiLinReg.ipynb : Multi-Linear Regression model with X = param_values and Y = TOA Global Net feedbacks in the first ensemble 
 - ENSEMBLE2_EmulateurFeedbacksN_pc1.ipynb : Random Forest and Neural Network whih X = param_values and Y = TOA Global Net raditaive feedbacks/TOA Net radiative fluxes in second ensemble.
 - ENSEMBLE2_LHS_Emulation.ipynb : Creation of Latin Hypercube sampling and emulation of second ensemble TOA global net radiative feedbacks with random forest and neural network. 
 - ENSEMBLE2_MultiLinReg.ipynb : Multi-Linear Regression model with X = param_values and Y = TOA Global Net feedbacks in the second ensemble.
##### ARPEGE_emulator  
 - Climatology_comparison.ipynb : tests  
 - correction_simulationTXT.sh : Shell  script to find which simulations failed and did not give outputs in /scratch/globc/dcom/ARPEGE6_TUNE. Then save the rows number in a file called 'missing_lines_simulations.txt'  
 - inputdata_file.npy  
 - missing_lines_simulations.txt  
 - NN_create.ipynb : Read 'simulations.csv' and create inputdata array : inputdata_file.npy (using 'missing_lines_simulations.txt' to delete the parameter dataset not used in simulations). Read '/PRE623TUN*.nc' and create outputdata array : outputdata_file.npy. Create and test out simple neural networks in Python with Keras.  
 - outputdata_file.npy  
 - Preprocessing.ipynb : tests  
 - simulations.csv  
 - simulations.txt
##### crash_emulator  
 - crash_amip-future4K.csv  
 - data.ipynb : create input and output numpy arrays based on .csv files 
 - emulator.ipynb : create and train random forest with X = param_values and Y = 0,crahs/1,succ√®s 
 - input.csv  
 - inputdata_file.npy  
 - NN_create.ipynb : test of a neural network to predict the crashes (fail) 
 - output.csv  
 - outputdata_file.npy  
 - param_analyse_future4K.ipynb : analyse emulator's outputs : pair_plot etc ...  
 - tree.dot  
 - tree.png

#### LHS_generate
 - ENSEMBLE2_LHS_Emulation.ipynb : perform Latin Hypecube sampling of param_values and emulate the TOA global net radiative feedbacks in the future ensemble.
##### SAVE
 - ENSEMBLE2_LHS500_param_values.txt : IMPORTANT : parameter values generated by 'ENSEMBLE2_LHS_Emulation.ipynb' and used for the simulation of the second ensemble (CNRM_PPE2) 
### files (relatives to the second ensemble only)
##### csv  
 - input.csv  
 - param.csv
##### npy  
 - CMIP6_NetFeedbcks.npy         
 - DeltaT_Out_global_mean.npy         
 - EmulateurFeedbacksN_LHS1000_pc1.npy  
 - LHS1000_param.npy   
 - Net_feedbacks.npy        
 - PPE2_EOF1pc_N.npy          
 - X_NoOut_MultiLinReg.npy
 - DeltaT_global_mean.npy        
 - emulated_NetFdbck.npy              
 - EOF1.npy                             
 - LHS500_param.npy    
 - Net_NoOut_feedbacks.npy  
 - X_EmulateurFeedbacksN.npy  
 - Y_MultiLinReg.npy
 - DeltaT_NoOut_global_mean.npy  
 - EmulateurFeedbacksN_LHS1000_N.npy  
 - EOF_analysis_eof1.npy                
 - LHS_paramNames.npy  
 - param_names.npy          
 - X_MultiLinReg.npy
##### txt
 - ENSEMBLE2_LHS500_param_values.txt : IMPORTANT : parameter values generated by 'ENSEMBLE2_LHS_Emulation.ipynb' and used for the simulation of the second ensemble (CNRM_PPE2) 
### trashes
## Fonctions.py 
 - File defining most of the python functions used in all the Jupyter's Notebooks. 

